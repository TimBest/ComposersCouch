{% extends 'base.html' %}
{% load crispy_forms_tags  %}
{% crispy AvailabilityForm AvailabilityForm.helper %}
{% crispy ZipcodeForm ZipcodeForm.helper %}

{% block headerClass %}feed {% block bgColor %}blue{% endblock %}{% endblock %}

{% block header %}
  <div class="main-nav">
    <div class="title">
      <span class="dropdown">
        <a class="btn btn-header dropdown-toggle toggle" data-toggle="dropdown" href="javascript:void(0)" aria-expanded="false">
          {{ feedType | capfirst }}<span class="caret-large text-white"></span>
        </a>
        <ul class="dropdown-menu" role="menu">
          <li class="{% block requestsClass %}{% endblock %}">
            {% if request.user.profile.profile_type == "m" %}
              <a href="{% url 'requests' 'expiring' 'band' 'any-distance' zipcode %}?{{ request.GET.urlencode }}">Requests</a>
            {% else %}
              <a href="{% url 'requests' 'expiring' 'venue' 'any-distance' zipcode %}?{{ request.GET.urlencode }}">Requests</a>
            {% endif %}
          </li>
          <li class="{% block showsClass %}{% endblock %}">
            <a href="{% url 'shows' 'upcoming' 'any-distance' zipcode %}?{{ request.GET.urlencode }}">Shows</a>
          </li>
          <li class="{% block artistsClass %}{% endblock %}">
            <a href="{% url 'artists' 'all' 'any-distance' zipcode %}?{{ request.GET.urlencode }}">Artists</a>
          </li>
          <li class="{% block venuesClass %}{% endblock %}">
            <a href="{% url 'venues' 'all' 'any-distance' zipcode %}?{{ request.GET.urlencode }}">Venues</a>
          </li>
          <li class="{% block updatesClass %}{% endblock %}">
            <a href="{% url 'updates' 'all' 'any-distance' zipcode %}?{{ request.GET.urlencode }}">Updates</a>
          </li>
        </ul>
      </span>
    </div>
    <div class="description">
      {% block forForm %}{% endblock %}
      {% block scope %}
        <span class="dropdown">
          <a class="btn btn-transparent-dropdown dropdown-toggle" href="#" type="button" data-toggle="dropdown" aria-expanded="true">
            <span class="dotted-bottom text-white">{% block currentScope %}within{% endblock %}</span>
          </a>
          <ul class="dropdown-menu">
            {% block scopeNav %}
              <li class="{% block withinClass %}active{% endblock %}">
                <a href="{% url feedType order 'any-distance' zipcode %}?{{ request.GET.urlencode }}">within</a>
              </li>
              <li class="{% block followingClass %}{% endblock %}">
                <a href="{% url feedType order 'following' zipcode %}?{{ request.GET.urlencode }}">I'm following</a>
              </li>
            {% endblock %}
          </ul>
        </span>
      {% endblock %}
      {% block availabilityForm %}
        <a href="#" role="button" data-toggle="popover"
           id="availability-select" class="toggle btn btn-transparent-dropdown text-white" title="Availability">
           <span class="dotted-bottom text-white">{% if date %}{{ date|date:"n/j/y" }}{% else %}Date{% endif %}</span>
        </a>
        <div class="availability-content hide">
          <form class="availability-form" role="filter" method="POST" action="{% url 'availability' %}">
            <input type="hidden" name="path" value="{% firstof request.path '/' %}">
            {% crispy availabilityForm %}
          </form>
        </div>
      {% endblock %}
      {% block zipcodeForm %}
        {% block distance %}
          <span class="dropdown">
            <a class="btn btn-transparent-dropdown dropdown-toggle" href="#" type="button" data-toggle="dropdown" aria-expanded="true">
              <span class="dotted-bottom text-white">{{ distance|default_if_none:"any distance" }}</span>
            </a>
            <ul class="dropdown-menu">
              {% block within %}
                <li class="{% ifequal scope '50' %}active{% endifequal %}">
                  <a href="{% url feedType order '50' zipcode %}?{{ request.GET.urlencode }}">50 miles</a>
                </li>
                <li class="{% ifequal scope 'any-distance' %}active{% endifequal %}">
                  <a href="{% url feedType order 'any-distance' zipcode %}?{{ request.GET.urlencode }}">any distance</a>
                </li>
              {% endblock %}
            </ul>
          </span>
          <span class="text-white">of</span>
        {% endblock %}
        <a href="#" role="button" data-toggle="popover" id="zipcode-select" class="toggle btn btn-transparent-dropdown" title="Zipcode">
          <span class="dotted-bottom text-white">{% if zipcode %}{{ zipcode }}{% else %}location{% endif %}</span>
        </a>
        <div class="zipcode-content hide">
          <form class="nav-form" role="filter" method="POST" action="{% url 'zipcode' %}">
            <input type="hidden" name="path" value="{% firstof request.path '/' %}">
            {% crispy zipcodeForm %}
          </form>
        </div>
      {% endblock %}
    </div>
  </div>
{% endblock %}

{% block navigation %}
<div class="navigation feed sub-nav">
  <div class="container-fluid">
    <div class="row no-gutter">
      <div class="col-xs-10 left">
        <ul class="nav nav-pills"></ul>
      </div>
      <div class="col-xs-2 right text-right">
        {% block filters %}
          <span class="dropdown text-left filters">
            <a class="btn btn-transparent-dropdown text-black filter dropdown-toggle"
               data-toggle="dropdown" href="javascript:void(0)" aria-expanded="false">
              Filters <span class="caret"></span>
            </a>
            <ul class="dropdown-menu" role="menu">
              {% block orderForm %}
                <li><label>Order</label></li>
                <li><div class="list-group">{% block orderOptions %}{% endblock %}</div></li>
              {% endblock %}
              {% block genreForm %}
                <li>
                  <b>Filter by:</b>
                  <div class="row no-gutter genres">
                    {% if my_genres %}
                      <a class="btn btn-xs btn-primary" href="{{ request.path }}">My genres X</a>
                    {% else %}
                      <a class="btn btn-xs btn-default" href="{{ request.path }}?my-genres=on">My genres</a>
                    {% endif %}
                    <span> or </span>
                    {% for genre in categories %}
                      {% if category == genre.slug %}
                        <a class="label label-primary" href="{{ request.path }}">{{ genre }} X</a>
                      {% else %}
                        <a class="label label-default" href="{{ request.path }}?genre={{ genre.slug }}">{{ genre }}</a>
                      {% endif %}
                    {% endfor %}
                    <span class="more-genres">
                      {% for genre in more_categories %}
                        {% if category == genre.slug %}
                          <a class="label label-primary" href="{{ request.path }}">{{ genre }} X</a>
                        {% else %}
                          <a class="label label-default" href="{{ request.path }}?genre={{ genre.slug }}">{{ genre }}</a>
                        {% endif %}
                      {% endfor %}
                    </span>
                  </div>
                  <a id="load-more-genres" class="btn btn-sm btn-default" href="javascript:void(0)">Show More</a>
                </li>
              {% endblock %}
            </ul>
          </span>
        {% endblock %}
      </div>
    </div>
  </div>
</div>
{% endblock %}

{% block content %}
  <div class="feed">
    <div class="cards">
      {% if category %}
        <p class="text-right">
          <a class="label label-primary" href="{{ request.path }}">{{ category }} X</a>
        </p>
      {% endif %}
      {% if my_genres %}
        <p class="text-right">
          <a class="label label-primary" href="{{ request.path }}">My Genres X</a>
        </p>
      {% endif %}
      {% block feed %}{% endblock %}
    </div>
  </div>
{% endblock %}
